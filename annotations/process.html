<!DOCTYPE html>  <html> <head>   <title>process.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="buffered.html">                 buffered.coffee               </a>                                           <a class="source" href="client.html">                 client.coffee               </a>                                           <a class="source" href="index.html">                 index.coffee               </a>                                           <a class="source" href="pool.html">                 pool.coffee               </a>                                           <a class="source" href="process.html">                 process.coffee               </a>                                           <a class="source" href="server.html">                 server.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               process.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-1">#</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nx">sys</span>           <span class="o">=</span> <span class="nx">require</span> <span class="s1">&#39;sys&#39;</span>
<span class="nx">client</span>        <span class="o">=</span> <span class="nx">require</span> <span class="s1">&#39;./client&#39;</span>
<span class="p">{</span><span class="nx">spawn</span><span class="p">,</span> <span class="nx">exec</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span> <span class="s1">&#39;child_process&#39;</span>
<span class="p">{</span><span class="nx">exists</span><span class="p">}</span>      <span class="o">=</span> <span class="nx">require</span> <span class="s1">&#39;path&#39;</span>

<span class="p">{</span><span class="nx">EventEmitter</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span> <span class="s1">&#39;events&#39;</span>
<span class="p">{</span><span class="nx">BufferedReadStream</span><span class="p">,</span> <span class="nx">BufferedLineStream</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span> <span class="s1">&#39;./buffered&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-2">#</a>               </div>               <p><strong>Process</strong> manages a single Ruby worker process.</p>

<p>A Process requires a path to a rackup config file <em>(config.ru)</em>.</p>

<pre><code>process.createProcess("/path/to/app/config.ru");
</code></pre>

<p>You can set a idle time so the process dies after a
specified amount of milliseconds.</p>

<pre><code>var ms = 15 * 60 * 1000;
process.createProcess("/path/to/app/config.ru", { idle: ms });
</code></pre>

<p>A Process has 5 states:</p>

<blockquote>
  <p><code>null</code>: Not started or dead</p>
  
  <p><code>spawning</code>: Is booting and can't accept a connection yet</p>
  
  <p><code>ready</code>: Is ready to accept a connection and handle a request</p>
  
  <p><code>busy</code>: Is currently handling a request, not ready</p>
  
  <p><code>quitting</code>: Was set a kill signal and is shutting down</p>
</blockquote>

<p>Anytime a process changes states, an event is fired with the new
state name. When the process becomes <code>ready</code>, a <code>ready</code> is fired.</p>

<p>Other events:</p>

<blockquote>
  <p><strong>Event: 'error'</strong></p>
  
  <p><code>function (exception) { }</code></p>
  
  <p>Emitted when an error occurs.</p>
  
  <p><strong>Event: 'spawn'</strong></p>
  
  <p><code>function (exception) { }</code></p>
  
  <p>Emitted when the process moves from <code>spawning</code> to <code>ready</code> state.</p>
  
  <p><strong>Event: 'exit'</strong></p>
  
  <p><code>function () { }</code></p>
  
  <p>Emitted when the Process terminates.</p>
  
  <p><strong>Event: 'idle'</strong></p>
  
  <p><code>function () { }</code></p>
  
  <p>Emitted when the Process times out because of inactivity.</p>
</blockquote>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">exports</span><span class="p">.</span><span class="nx">Process</span> <span class="o">=</span> <span class="k">class</span> <span class="nx">Process</span> <span class="k">extends</span> <span class="nx">EventEmitter</span>
  <span class="nv">constructor: </span><span class="p">(</span><span class="nx">@config</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">options</span> <span class="o">?=</span> <span class="p">{}</span>
    <span class="nx">@idle</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">idle</span>
    <span class="nx">@cwd</span>  <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">cwd</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-3">#</a>               </div>               <p>Set initial state to <code>null</code></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@state</span> <span class="o">=</span> <span class="kc">null</span>

    <span class="nx">raiseConfigError</span> <span class="o">=</span> <span class="o">=&gt;</span>
      <span class="nx">@emit</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s2">&quot;configuration \&quot;#{@config}\&quot; doesn&#39;t exist&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-4">#</a>               </div>               <p>Raise an exception unless <code>config</code> exists</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@config</span><span class="o">?</span>
      <span class="nx">exists</span> <span class="nx">@config</span><span class="p">,</span> <span class="p">(</span><span class="nx">ok</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">raiseConfigError</span><span class="p">()</span> <span class="k">if</span> <span class="o">!</span><span class="nx">ok</span>
    <span class="k">else</span>
      <span class="nx">raiseConfigError</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-5">#</a>               </div>               <p>Push back the idle time everytime a request is handled</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@on</span> <span class="s1">&#39;busy&#39;</span><span class="p">,</span> <span class="o">=&gt;</span>
      <span class="nx">@deferTimeout</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-6">#</a>               </div>               <p>Expand path to <code>nack_worker</code> command</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">getNackWorkerPath: </span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@nackWorkerPath</span><span class="o">?</span>
      <span class="nx">callback</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">@nackWorkerPath</span>
    <span class="k">else</span>
      <span class="nx">exec</span> <span class="s1">&#39;which nack_worker&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">stdout</span><span class="p">,</span> <span class="nx">stderr</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="k">if</span> <span class="nx">error</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-7">#</a>               </div>               <p>Throw an exception if <code>nack_worker</code> isn't in the <code>PATH</code>.</p>

<p>Probably need to <code>gem install nack</code> or fix shitty rubygems</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">callback</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s2">&quot;Couldn&#39;t find `nack_worker` in PATH&quot;</span>
        <span class="k">else</span>
          <span class="nx">@nackWorkerPath</span> <span class="o">=</span> <span class="nx">stdout</span><span class="p">.</span><span class="nx">replace</span> <span class="sr">/(\n|\r)+$/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>
          <span class="nx">callback</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">@nackWorkerPath</span>

  <span class="nv">spawn: </span><span class="p">()</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-8">#</a>               </div>               <p>Do nothing if the process is already started</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="k">if</span> <span class="nx">@state</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-9">#</a>               </div>               <p>Change start to <code>spawning</code> and fire an event</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@changeState</span> <span class="s1">&#39;spawning&#39;</span>

    <span class="nx">@getNackWorkerPath</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">nackWorker</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-10">#</a>               </div>               <p>Bubble error from <code>getNackWorkerPath</code></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="nx">@emit</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">err</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-11">#</a>               </div>               <p>Generate a random sock path</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@sockPath</span> <span class="o">=</span> <span class="nx">tmpSock</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-12">#</a>               </div>               <p>Spawn a Ruby server connecting to our <code>@sockPath</code></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@child</span> <span class="o">=</span> <span class="nx">spawn</span> <span class="nx">nackWorker</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;--file&#39;</span><span class="p">,</span> <span class="nx">@sockPath</span><span class="p">,</span> <span class="nx">@config</span><span class="p">],</span>
        <span class="nv">cwd: </span><span class="nx">@cwd</span>
        <span class="nv">env: </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-13">#</a>               </div>               <p>Expose <code>stdout</code> and <code>stderr</code> on Process</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@stdout</span> <span class="o">=</span> <span class="nx">@child</span><span class="p">.</span><span class="nx">stdout</span>
      <span class="nx">@stderr</span> <span class="o">=</span> <span class="nx">@child</span><span class="p">.</span><span class="nx">stderr</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-14">#</a>               </div>               <p>Listen for "ready" line on process stdout</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">readyLineHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">line</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="k">if</span> <span class="nx">line</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">is</span> <span class="s2">&quot;ready&quot;</span>
          <span class="nx">@stdout</span><span class="p">.</span><span class="nx">removeListener</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nx">readyLineHandler</span>
          <span class="nx">@changeState</span> <span class="s1">&#39;ready&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-15">#</a>               </div>               <p>Wrap stdout with a line buffer</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">stdoutLines</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BufferedLineStream</span> <span class="nx">@stdout</span>
      <span class="nx">stdoutLines</span><span class="p">.</span><span class="kc">on</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nx">readyLineHandler</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-16">#</a>               </div>               <p>When the child process exists, clear out state and
emit <code>exit</code></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@child</span><span class="p">.</span><span class="kc">on</span> <span class="s1">&#39;exit&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">signal</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">@clearTimeout</span><span class="p">()</span>
        <span class="nx">@state</span> <span class="o">=</span> <span class="nx">@sockPath</span> <span class="o">=</span> <span class="nx">@child</span> <span class="o">=</span> <span class="kc">null</span>
        <span class="nx">@stdout</span> <span class="o">=</span> <span class="nx">@stderr</span> <span class="o">=</span> <span class="kc">null</span>
        <span class="nx">@emit</span> <span class="s1">&#39;exit&#39;</span>

      <span class="nx">@emit</span> <span class="s1">&#39;spawn&#39;</span>

    <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-17">#</a>               </div>               <p>Register a callback to only run once on the next event.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">onNext: </span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">listener</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">callback</span> <span class="o">=</span> <span class="p">(</span><span class="nx">args</span><span class="p">...)</span> <span class="o">=&gt;</span>
      <span class="nx">@removeListener</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span>
      <span class="nx">listener</span> <span class="nx">args</span><span class="p">...</span>
    <span class="nx">@on</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-18">#</a>               </div>               <p>Change the current state and fire a corresponding event</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">changeState: </span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@state</span> <span class="o">!=</span> <span class="nx">state</span>
      <span class="nx">@state</span> <span class="o">=</span> <span class="nx">state</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-19">#</a>               </div>               <p>State change events are always asynchronous</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">process</span><span class="p">.</span><span class="nx">nextTick</span> <span class="o">=&gt;</span> <span class="nx">@emit</span> <span class="nx">state</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-20">#</a>               </div>               <p>Wait for state and invoke the callback.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">onState: </span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-21">#</a>               </div>               <p>If we're already in the state, just do it</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@state</span> <span class="o">==</span> <span class="nx">state</span>
      <span class="nx">callback</span><span class="p">()</span>
    <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-22">#</a>               </div>               <p>Wait for next state change and check again</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@onNext</span> <span class="nx">state</span><span class="p">,</span> <span class="o">=&gt;</span>
        <span class="nx">@onState</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-23">#</a>               </div>               <p>Clear current timeout handler.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">clearTimeout: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@_timeoutId</span>
      <span class="nx">clearTimeout</span> <span class="nx">@_timeoutId</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-24">#</a>               </div>               <p>Defer the current idle timer.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">deferTimeout: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@idle</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-25">#</a>               </div>               <p>Clear the current timer</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@clearTimeout</span><span class="p">()</span>

      <span class="nx">callback</span> <span class="o">=</span> <span class="o">=&gt;</span>
        <span class="nx">@emit</span> <span class="s1">&#39;idle&#39;</span>
        <span class="nx">@quit</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-26">#</a>               </div>               <p>Register a new timer</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@_timeoutId</span> <span class="o">=</span> <span class="nx">setTimeout</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">@idle</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-27">#</a>               </div>               <p>Create a new <strong>Client</strong> connection</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">createConnection: </span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-28">#</a>               </div>               <p>Start child process if we haven't already</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@spawn</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-29">#</a>               </div>               <p>Wait till the process is ready</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@onState</span> <span class="s1">&#39;ready&#39;</span><span class="p">,</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-30">#</a>               </div>               <p>Immediately flag process as <code>busy</code></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@changeState</span> <span class="s1">&#39;busy&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-31">#</a>               </div>               <p>Create a connection to our sock path</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">connection</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">createConnection</span> <span class="nx">@sockPath</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-32">#</a>               </div>               <p>When the connection closes, change the state back
to ready.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">connection</span><span class="p">.</span><span class="kc">on</span> <span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span>
        <span class="nx">@changeState</span> <span class="s1">&#39;ready&#39;</span>

      <span class="nx">callback</span> <span class="nx">connection</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-33">#</a>               </div>               <p>Proxies a <code>http.ServerRequest</code> and <code>http.ServerResponse</code> to the process</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">proxyRequest: </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-34">#</a>               </div>               <p>Wrap the <code>http.ServerRequest</code> with a <code>BufferedReadStream</code>
so we don't miss any <code>data</code> or <code>end</code> events.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">reqBuf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BufferedReadStream</span> <span class="nx">req</span>

    <span class="nx">@createConnection</span> <span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="nx">connection</span><span class="p">.</span><span class="nx">proxyRequest</span> <span class="nx">reqBuf</span><span class="p">,</span> <span class="nx">res</span>

      <span class="k">if</span> <span class="nx">callback</span>
        <span class="nx">connection</span><span class="p">.</span><span class="kc">on</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">callback</span>
        <span class="nx">connection</span><span class="p">.</span><span class="kc">on</span> <span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-35">#</a>               </div>               <p>Flush any events captured while we were establishing
our client connection</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">reqBuf</span><span class="p">.</span><span class="nx">flush</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-36">#</a>               </div>               <p>Send <code>SIGTERM</code> to process.
This will immediately kill it.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">terminate: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@child</span>
      <span class="nx">@changeState</span> <span class="s1">&#39;quitting&#39;</span>
      <span class="nx">@child</span><span class="p">.</span><span class="nx">kill</span> <span class="s1">&#39;SIGTERM&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-37">#</a>               </div>               <p>Send <code>SIGTERM</code> to process.
The process will finish serving its request and gracefully quit.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">quit: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@child</span>
      <span class="nx">@changeState</span> <span class="s1">&#39;quitting&#39;</span>
      <span class="nx">@child</span><span class="p">.</span><span class="nx">kill</span> <span class="s1">&#39;SIGQUIT&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-38">#</a>               </div>               <p>Public API for creating a <strong>Process</strong></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">exports</span><span class="p">.</span><span class="nx">createProcess</span> <span class="o">=</span> <span class="p">(</span><span class="nx">args</span><span class="p">...)</span> <span class="o">-&gt;</span>
  <span class="k">new</span> <span class="nx">Process</span> <span class="nx">args</span><span class="p">...</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-39">#</a>               </div>               <p>Generates a random sock path.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">tmpSock</span> <span class="o">=</span> <span class="o">-&gt;</span>
  <span class="nx">pid</span>  <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">pid</span>
  <span class="nx">rand</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10000000000</span>
  <span class="s2">&quot;/tmp/nack.&quot;</span> <span class="o">+</span> <span class="nx">pid</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nx">rand</span> <span class="o">+</span> <span class="s2">&quot;.sock&quot;</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 